{"version":3,"sources":["webpack:///./node_modules/@firebase/functions/dist/index.cjs.js","webpack:///./node_modules/@firebase/component/dist/index.cjs.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/@firebase/logger/dist/index.esm.js"],"names":["firebase","tslib","component","_interopDefaultLegacy","e","firebase__default","errorCodeMap","OK","CANCELLED","UNKNOWN","INVALID_ARGUMENT","DEADLINE_EXCEEDED","NOT_FOUND","ALREADY_EXISTS","PERMISSION_DENIED","UNAUTHENTICATED","RESOURCE_EXHAUSTED","FAILED_PRECONDITION","ABORTED","OUT_OF_RANGE","UNIMPLEMENTED","INTERNAL","UNAVAILABLE","DATA_LOSS","HttpsErrorImpl","_super","code","message","details","_this","call","this","Object","setPrototypeOf","prototype","__extends","Error","codeForHTTPStatus","status","_errorForResponse","bodyJSON","serializer","description","undefined","errorJSON","error","status_1","decode","ContextProvider","authProvider","messagingProvider","auth","messaging","getImmediate","optional","get","then","getAuthToken","__awaiter","token","__generator","_a","label","trys","push","getToken","sent","accessToken","getInstanceIdToken","self","Notification","permission","getContext","authToken","instanceIdToken","LONG_TYPE","UNSIGNED_LONG_TYPE","mapValues","o","f","result","key","hasOwnProperty","Serializer","encode","data","Number","valueOf","isFinite","toString","Array","isArray","map","x","json","value","isNaN","failAfter","millis","timer","promise","Promise","_","reject","setTimeout","Service","app_","regionOrCustomDomain_","fetchImpl","emulatorOrigin","delete","resolve","deleteService","contextProvider","cancelAllRequests","url","URL","customDomain","origin","region","defineProperty","enumerable","configurable","_url","name","projectId","options","origin_1","useFunctionsEmulator","httpsCallable","postJSON","body","headers","response","method","JSON","stringify","context","timeout","failAfterPromise","responseData","decodedData","_b","race","clearTimeoutWrapper","clearTimeout","FUNCTIONS_TYPE","registerFunctions","instance","namespaceExports","Functions","factory","container","regionOrCustomDomain","app","getProvider","registerComponent","Component","setServiceProps","setMultipleInstances","version","fetch","bind","registerVersion","exports","util","instanceFactory","type","multipleInstances","serviceProps","instantiationMode","setInstantiationMode","mode","props","DEFAULT_ENTRY_NAME","Provider","instances","Map","instancesDeferred","identifier","normalizedIdentifier","normalizeInstanceIdentifier","has","deferred","Deferred","set","getOrInitializeService","__assign","getComponent","setComponent","e_1","isComponentEager","__values","entries","_c","next","done","_d","__read","instanceIdentifier","instanceDeferred","e_1_1","return","clearInstance","services","from","values","all","__spread","filter","service","_delete","isComponentSet","normalizeIdentifierForFactory","ComponentContainer","providers","addComponent","provider","addOrOverwriteComponent","getProviders","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","includes","getInstallationsEndpoint","extractAuthTokenInfoFromResponse","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","responseJson","errorData","create","serverCode","serverMessage","serverStatus","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","append","getAuthorizationHeader","retryIfServerError","fn","responseExpiresIn","replace","createInstallationRequest","fid","endpoint","request","responseValue","registeredInstallationEntry","authVersion","appId","sdkVersion","ok","registrationStatus","sleep","ms","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","crypto","msCrypto","getRandomValues","test","b64String","substr","getKey","appName","fidChangeCallbacks","fidChanged","callFidChangeCallbacks","broadcastFidChange","addCallback","callback","getBroadcastChannel","callbackSet","Set","add","removeCallback","size","closeBroadcastChannel","callbacks","callbacks_1","callbacks_1_1","channel","postMessage","broadcastChannel","BroadcastChannel","onmessage","close","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","db","tx","objectStore","oldValue","transaction","put","complete","remove","update","updateFn","store","newValue","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","navigator","onLine","registrationPromiseWithError","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","platformLoggerProvider","platformLogger","completedAuthToken","getGenerateAuthTokenEndpoint","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","getId","catch","console","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","deleteInstallation","onIdChange","extractAppConfig","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","keyName","valueName","registerInstallations","installationsName","installations","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","LogLevel","levelStringToEnum","DEBUG","VERBOSE","INFO","WARN","ERROR","SILENT","defaultLogLevel","ConsoleMethod","defaultLogHandler","logType","args","_i","logLevel","toISOString","Logger","_logLevel","_logHandler","_userLogHandler","val","TypeError","setLogLevel","debug","log","info","warn","level","forEach","inst","setUserLogHandler","logCallback","_loop_1","customLogLevel","userLogHandler","arg","ignored","join","toLowerCase","instances_1"],"mappings":"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","file":"js/chunk-vendors~1fb195ae.4c80839f.js","sourcesContent":["'use strict';\n\nvar firebase = require('@firebase/app');\nvar tslib = require('tslib');\nvar component = require('@firebase/component');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar firebase__default = /*#__PURE__*/_interopDefaultLegacy(firebase);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Standard error codes for different ways a request can fail, as defined by:\r\n * https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto\r\n *\r\n * This map is used primarily to convert from a backend error code string to\r\n * a client SDK error code string, and make sure it's in the supported set.\r\n */\r\nvar errorCodeMap = {\r\n    OK: 'ok',\r\n    CANCELLED: 'cancelled',\r\n    UNKNOWN: 'unknown',\r\n    INVALID_ARGUMENT: 'invalid-argument',\r\n    DEADLINE_EXCEEDED: 'deadline-exceeded',\r\n    NOT_FOUND: 'not-found',\r\n    ALREADY_EXISTS: 'already-exists',\r\n    PERMISSION_DENIED: 'permission-denied',\r\n    UNAUTHENTICATED: 'unauthenticated',\r\n    RESOURCE_EXHAUSTED: 'resource-exhausted',\r\n    FAILED_PRECONDITION: 'failed-precondition',\r\n    ABORTED: 'aborted',\r\n    OUT_OF_RANGE: 'out-of-range',\r\n    UNIMPLEMENTED: 'unimplemented',\r\n    INTERNAL: 'internal',\r\n    UNAVAILABLE: 'unavailable',\r\n    DATA_LOSS: 'data-loss'\r\n};\r\n/**\r\n * An explicit error that can be thrown from a handler to send an error to the\r\n * client that called the function.\r\n */\r\nvar HttpsErrorImpl = /** @class */ (function (_super) {\r\n    tslib.__extends(HttpsErrorImpl, _super);\r\n    function HttpsErrorImpl(code, message, details) {\r\n        var _this = _super.call(this, message) || this;\r\n        // This is a workaround for a bug in TypeScript when extending Error:\r\n        // tslint:disable-next-line\r\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n        Object.setPrototypeOf(_this, HttpsErrorImpl.prototype);\r\n        _this.code = code;\r\n        _this.details = details;\r\n        return _this;\r\n    }\r\n    return HttpsErrorImpl;\r\n}(Error));\r\n/**\r\n * Takes an HTTP status code and returns the corresponding ErrorCode.\r\n * This is the standard HTTP status code -> error mapping defined in:\r\n * https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto\r\n *\r\n * @param status An HTTP status code.\r\n * @return The corresponding ErrorCode, or ErrorCode.UNKNOWN if none.\r\n */\r\nfunction codeForHTTPStatus(status) {\r\n    // Make sure any successful status is OK.\r\n    if (status >= 200 && status < 300) {\r\n        return 'ok';\r\n    }\r\n    switch (status) {\r\n        case 0:\r\n            // This can happen if the server returns 500.\r\n            return 'internal';\r\n        case 400:\r\n            return 'invalid-argument';\r\n        case 401:\r\n            return 'unauthenticated';\r\n        case 403:\r\n            return 'permission-denied';\r\n        case 404:\r\n            return 'not-found';\r\n        case 409:\r\n            return 'aborted';\r\n        case 429:\r\n            return 'resource-exhausted';\r\n        case 499:\r\n            return 'cancelled';\r\n        case 500:\r\n            return 'internal';\r\n        case 501:\r\n            return 'unimplemented';\r\n        case 503:\r\n            return 'unavailable';\r\n        case 504:\r\n            return 'deadline-exceeded';\r\n    }\r\n    return 'unknown';\r\n}\r\n/**\r\n * Takes an HTTP response and returns the corresponding Error, if any.\r\n */\r\nfunction _errorForResponse(status, bodyJSON, serializer) {\r\n    var code = codeForHTTPStatus(status);\r\n    // Start with reasonable defaults from the status code.\r\n    var description = code;\r\n    var details = undefined;\r\n    // Then look through the body for explicit details.\r\n    try {\r\n        var errorJSON = bodyJSON && bodyJSON.error;\r\n        if (errorJSON) {\r\n            var status_1 = errorJSON.status;\r\n            if (typeof status_1 === 'string') {\r\n                if (!errorCodeMap[status_1]) {\r\n                    // They must've included an unknown error code in the body.\r\n                    return new HttpsErrorImpl('internal', 'internal');\r\n                }\r\n                code = errorCodeMap[status_1];\r\n                // TODO(klimt): Add better default descriptions for error enums.\r\n                // The default description needs to be updated for the new code.\r\n                description = status_1;\r\n            }\r\n            var message = errorJSON.message;\r\n            if (typeof message === 'string') {\r\n                description = message;\r\n            }\r\n            details = errorJSON.details;\r\n            if (details !== undefined) {\r\n                details = serializer.decode(details);\r\n            }\r\n        }\r\n    }\r\n    catch (e) {\r\n        // If we couldn't parse explicit error data, that's fine.\r\n    }\r\n    if (code === 'ok') {\r\n        // Technically, there's an edge case where a developer could explicitly\r\n        // return an error code of OK, and we will treat it as success, but that\r\n        // seems reasonable.\r\n        return null;\r\n    }\r\n    return new HttpsErrorImpl(code, description, details);\r\n}\n\n/**\r\n * Helper class to get metadata that should be included with a function call.\r\n */\r\nvar ContextProvider = /** @class */ (function () {\r\n    function ContextProvider(authProvider, messagingProvider) {\r\n        var _this = this;\r\n        this.auth = null;\r\n        this.messaging = null;\r\n        this.auth = authProvider.getImmediate({ optional: true });\r\n        this.messaging = messagingProvider.getImmediate({\r\n            optional: true\r\n        });\r\n        if (!this.auth) {\r\n            authProvider.get().then(function (auth) { return (_this.auth = auth); }, function () {\r\n                /* get() never rejects */\r\n            });\r\n        }\r\n        if (!this.messaging) {\r\n            messagingProvider.get().then(function (messaging) { return (_this.messaging = messaging); }, function () {\r\n                /* get() never rejects */\r\n            });\r\n        }\r\n    }\r\n    ContextProvider.prototype.getAuthToken = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var token, e_1;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.auth) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.auth.getToken()];\r\n                    case 2:\r\n                        token = _a.sent();\r\n                        if (!token) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        return [2 /*return*/, token.accessToken];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        // If there's any error when trying to get the auth token, leave it off.\r\n                        return [2 /*return*/, undefined];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ContextProvider.prototype.getInstanceIdToken = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            return tslib.__generator(this, function (_a) {\r\n                if (!this.messaging ||\r\n                    !('Notification' in self) ||\r\n                    Notification.permission !== 'granted') {\r\n                    return [2 /*return*/, undefined];\r\n                }\r\n                try {\r\n                    return [2 /*return*/, this.messaging.getToken()];\r\n                }\r\n                catch (e) {\r\n                    // We don't warn on this, because it usually means messaging isn't set up.\r\n                    // console.warn('Failed to retrieve instance id token.', e);\r\n                    // If there's any error when trying to get the token, leave it off.\r\n                    return [2 /*return*/, undefined];\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    ContextProvider.prototype.getContext = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var authToken, instanceIdToken;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getAuthToken()];\r\n                    case 1:\r\n                        authToken = _a.sent();\r\n                        return [4 /*yield*/, this.getInstanceIdToken()];\r\n                    case 2:\r\n                        instanceIdToken = _a.sent();\r\n                        return [2 /*return*/, { authToken: authToken, instanceIdToken: instanceIdToken }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar LONG_TYPE = 'type.googleapis.com/google.protobuf.Int64Value';\r\nvar UNSIGNED_LONG_TYPE = 'type.googleapis.com/google.protobuf.UInt64Value';\r\nfunction mapValues(\r\n// { [k: string]: unknown } is no longer a wildcard assignment target after typescript 3.5\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\no, f) {\r\n    var result = {};\r\n    for (var key in o) {\r\n        if (o.hasOwnProperty(key)) {\r\n            result[key] = f(o[key]);\r\n        }\r\n    }\r\n    return result;\r\n}\r\nvar Serializer = /** @class */ (function () {\r\n    function Serializer() {\r\n    }\r\n    // Takes data and encodes it in a JSON-friendly way, such that types such as\r\n    // Date are preserved.\r\n    Serializer.prototype.encode = function (data) {\r\n        var _this = this;\r\n        if (data == null) {\r\n            return null;\r\n        }\r\n        if (data instanceof Number) {\r\n            data = data.valueOf();\r\n        }\r\n        if (typeof data === 'number' && isFinite(data)) {\r\n            // Any number in JS is safe to put directly in JSON and parse as a double\r\n            // without any loss of precision.\r\n            return data;\r\n        }\r\n        if (data === true || data === false) {\r\n            return data;\r\n        }\r\n        if (Object.prototype.toString.call(data) === '[object String]') {\r\n            return data;\r\n        }\r\n        if (Array.isArray(data)) {\r\n            return data.map(function (x) { return _this.encode(x); });\r\n        }\r\n        if (typeof data === 'function' || typeof data === 'object') {\r\n            return mapValues(data, function (x) { return _this.encode(x); });\r\n        }\r\n        // If we got this far, the data is not encodable.\r\n        throw new Error('Data cannot be encoded in JSON: ' + data);\r\n    };\r\n    // Takes data that's been encoded in a JSON-friendly form and returns a form\r\n    // with richer datatypes, such as Dates, etc.\r\n    Serializer.prototype.decode = function (json) {\r\n        var _this = this;\r\n        if (json == null) {\r\n            return json;\r\n        }\r\n        if (json['@type']) {\r\n            switch (json['@type']) {\r\n                case LONG_TYPE:\r\n                // Fall through and handle this the same as unsigned.\r\n                case UNSIGNED_LONG_TYPE: {\r\n                    // Technically, this could work return a valid number for malformed\r\n                    // data if there was a number followed by garbage. But it's just not\r\n                    // worth all the extra code to detect that case.\r\n                    var value = Number(json['value']);\r\n                    if (isNaN(value)) {\r\n                        throw new Error('Data cannot be decoded from JSON: ' + json);\r\n                    }\r\n                    return value;\r\n                }\r\n                default: {\r\n                    throw new Error('Data cannot be decoded from JSON: ' + json);\r\n                }\r\n            }\r\n        }\r\n        if (Array.isArray(json)) {\r\n            return json.map(function (x) { return _this.decode(x); });\r\n        }\r\n        if (typeof json === 'function' || typeof json === 'object') {\r\n            return mapValues(json, function (x) { return _this.decode(x); });\r\n        }\r\n        // Anything else is safe to return.\r\n        return json;\r\n    };\r\n    return Serializer;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a Promise that will be rejected after the given duration.\r\n * The error will be of type HttpsErrorImpl.\r\n *\r\n * @param millis Number of milliseconds to wait before rejecting.\r\n */\r\nfunction failAfter(millis) {\r\n    var timer;\r\n    var promise = new Promise(function (_, reject) {\r\n        timer = setTimeout(function () {\r\n            reject(new HttpsErrorImpl('deadline-exceeded', 'deadline-exceeded'));\r\n        }, millis);\r\n    });\r\n    return {\r\n        timer: timer,\r\n        promise: promise\r\n    };\r\n}\r\n/**\r\n * The main class for the Firebase Functions SDK.\r\n */\r\nvar Service = /** @class */ (function () {\r\n    /**\r\n     * Creates a new Functions service for the given app and (optional) region or custom domain.\r\n     * @param app_ The FirebaseApp to use.\r\n     * @param regionOrCustomDomain_ one of:\r\n     *   a) A region to call functions from, such as us-central1\r\n     *   b) A custom domain to use as a functions prefix, such as https://mydomain.com\r\n     */\r\n    function Service(app_, authProvider, messagingProvider, regionOrCustomDomain_, fetchImpl) {\r\n        var _this = this;\r\n        if (regionOrCustomDomain_ === void 0) { regionOrCustomDomain_ = 'us-central1'; }\r\n        this.app_ = app_;\r\n        this.fetchImpl = fetchImpl;\r\n        this.serializer = new Serializer();\r\n        this.emulatorOrigin = null;\r\n        this.INTERNAL = {\r\n            delete: function () {\r\n                return Promise.resolve(_this.deleteService());\r\n            }\r\n        };\r\n        this.contextProvider = new ContextProvider(authProvider, messagingProvider);\r\n        // Cancels all ongoing requests when resolved.\r\n        this.cancelAllRequests = new Promise(function (resolve) {\r\n            _this.deleteService = function () {\r\n                return resolve();\r\n            };\r\n        });\r\n        // Resolve the region or custom domain overload by attempting to parse it.\r\n        try {\r\n            var url = new URL(regionOrCustomDomain_);\r\n            this.customDomain = url.origin;\r\n            this.region = 'us-central1';\r\n        }\r\n        catch (e) {\r\n            this.customDomain = null;\r\n            this.region = regionOrCustomDomain_;\r\n        }\r\n    }\r\n    Object.defineProperty(Service.prototype, \"app\", {\r\n        get: function () {\r\n            return this.app_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns the URL for a callable with the given name.\r\n     * @param name The name of the callable.\r\n     */\r\n    Service.prototype._url = function (name) {\r\n        var projectId = this.app_.options.projectId;\r\n        if (this.emulatorOrigin !== null) {\r\n            var origin_1 = this.emulatorOrigin;\r\n            return origin_1 + \"/\" + projectId + \"/\" + this.region + \"/\" + name;\r\n        }\r\n        if (this.customDomain !== null) {\r\n            return this.customDomain + \"/\" + name;\r\n        }\r\n        return \"https://\" + this.region + \"-\" + projectId + \".cloudfunctions.net/\" + name;\r\n    };\r\n    /**\r\n     * Changes this instance to point to a Cloud Functions emulator running\r\n     * locally. See https://firebase.google.com/docs/functions/local-emulator\r\n     *\r\n     * @param origin The origin of the local emulator, such as\r\n     * \"http://localhost:5005\".\r\n     */\r\n    Service.prototype.useFunctionsEmulator = function (origin) {\r\n        this.emulatorOrigin = origin;\r\n    };\r\n    /**\r\n     * Returns a reference to the callable https trigger with the given name.\r\n     * @param name The name of the trigger.\r\n     */\r\n    Service.prototype.httpsCallable = function (name, options) {\r\n        var _this = this;\r\n        return function (data) {\r\n            return _this.call(name, data, options || {});\r\n        };\r\n    };\r\n    /**\r\n     * Does an HTTP POST and returns the completed response.\r\n     * @param url The url to post to.\r\n     * @param body The JSON body of the post.\r\n     * @param headers The HTTP headers to include in the request.\r\n     * @return A Promise that will succeed when the request finishes.\r\n     */\r\n    Service.prototype.postJSON = function (url, body, headers) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var response, e_1, json, e_2;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        headers['Content-Type'] = 'application/json';\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.fetchImpl(url, {\r\n                                method: 'POST',\r\n                                body: JSON.stringify(body),\r\n                                headers: headers\r\n                            })];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        // This could be an unhandled error on the backend, or it could be a\r\n                        // network error. There's no way to know, since an unhandled error on the\r\n                        // backend will fail to set the proper CORS header, and thus will be\r\n                        // treated as a network error by fetch.\r\n                        return [2 /*return*/, {\r\n                                status: 0,\r\n                                json: null\r\n                            }];\r\n                    case 4:\r\n                        json = null;\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 6:\r\n                        json = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        e_2 = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 8: return [2 /*return*/, {\r\n                            status: response.status,\r\n                            json: json\r\n                        }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Calls a callable function asynchronously and returns the result.\r\n     * @param name The name of the callable trigger.\r\n     * @param data The data to pass as params to the function.s\r\n     */\r\n    Service.prototype.call = function (name, data, options) {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var url, body, headers, context, timeout, _a, timer, failAfterPromise, response, error, responseData, decodedData;\r\n            return tslib.__generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        url = this._url(name);\r\n                        // Encode any special types, such as dates, in the input data.\r\n                        data = this.serializer.encode(data);\r\n                        body = { data: data };\r\n                        headers = {};\r\n                        return [4 /*yield*/, this.contextProvider.getContext()];\r\n                    case 1:\r\n                        context = _b.sent();\r\n                        if (context.authToken) {\r\n                            headers['Authorization'] = 'Bearer ' + context.authToken;\r\n                        }\r\n                        if (context.instanceIdToken) {\r\n                            headers['Firebase-Instance-ID-Token'] = context.instanceIdToken;\r\n                        }\r\n                        timeout = options.timeout || 70000;\r\n                        _a = failAfter(timeout), timer = _a.timer, failAfterPromise = _a.promise;\r\n                        return [4 /*yield*/, Promise.race([\r\n                                clearTimeoutWrapper(timer, this.postJSON(url, body, headers)),\r\n                                failAfterPromise,\r\n                                clearTimeoutWrapper(timer, this.cancelAllRequests)\r\n                            ])];\r\n                    case 2:\r\n                        response = _b.sent();\r\n                        // If service was deleted, interrupted response throws an error.\r\n                        if (!response) {\r\n                            throw new HttpsErrorImpl('cancelled', 'Firebase Functions instance was deleted.');\r\n                        }\r\n                        error = _errorForResponse(response.status, response.json, this.serializer);\r\n                        if (error) {\r\n                            throw error;\r\n                        }\r\n                        if (!response.json) {\r\n                            throw new HttpsErrorImpl('internal', 'Response is not valid JSON object.');\r\n                        }\r\n                        responseData = response.json.data;\r\n                        // TODO(klimt): For right now, allow \"result\" instead of \"data\", for\r\n                        // backwards compatibility.\r\n                        if (typeof responseData === 'undefined') {\r\n                            responseData = response.json.result;\r\n                        }\r\n                        if (typeof responseData === 'undefined') {\r\n                            // Consider the response malformed.\r\n                            throw new HttpsErrorImpl('internal', 'Response is missing data field.');\r\n                        }\r\n                        decodedData = this.serializer.decode(responseData);\r\n                        return [2 /*return*/, { data: decodedData }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Service;\r\n}());\r\nfunction clearTimeoutWrapper(timer, promise) {\r\n    return tslib.__awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return tslib.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, promise];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                    clearTimeout(timer);\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Type constant for Firebase Functions.\r\n */\r\nvar FUNCTIONS_TYPE = 'functions';\r\nfunction registerFunctions(instance, fetchImpl) {\r\n    var namespaceExports = {\r\n        // no-inline\r\n        Functions: Service\r\n    };\r\n    function factory(container, regionOrCustomDomain) {\r\n        // Dependencies\r\n        var app = container.getProvider('app').getImmediate();\r\n        var authProvider = container.getProvider('auth-internal');\r\n        var messagingProvider = container.getProvider('messaging');\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        return new Service(app, authProvider, messagingProvider, regionOrCustomDomain, fetchImpl);\r\n    }\r\n    instance.INTERNAL.registerComponent(new component.Component(FUNCTIONS_TYPE, factory, \"PUBLIC\" /* PUBLIC */)\r\n        .setServiceProps(namespaceExports)\r\n        .setMultipleInstances(true));\r\n}\n\nvar name = \"@firebase/functions\";\nvar version = \"0.5.1\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nregisterFunctions(firebase__default['default'], fetch.bind(self));\r\nfirebase__default['default'].registerVersion(name, version);\n//# sourceMappingURL=index.cjs.js.map\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tslib = require('tslib');\nvar util = require('@firebase/util');\n\n/**\r\n * Component for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nvar Component = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param name The public service name, e.g. app, auth, firestore, database\r\n     * @param instanceFactory Service factory responsible for creating the public interface\r\n     * @param type whether the service provided by the component is public or private\r\n     */\r\n    function Component(name, instanceFactory, type) {\r\n        this.name = name;\r\n        this.instanceFactory = instanceFactory;\r\n        this.type = type;\r\n        this.multipleInstances = false;\r\n        /**\r\n         * Properties to be added to the service namespace\r\n         */\r\n        this.serviceProps = {};\r\n        this.instantiationMode = \"LAZY\" /* LAZY */;\r\n    }\r\n    Component.prototype.setInstantiationMode = function (mode) {\r\n        this.instantiationMode = mode;\r\n        return this;\r\n    };\r\n    Component.prototype.setMultipleInstances = function (multipleInstances) {\r\n        this.multipleInstances = multipleInstances;\r\n        return this;\r\n    };\r\n    Component.prototype.setServiceProps = function (props) {\r\n        this.serviceProps = props;\r\n        return this;\r\n    };\r\n    return Component;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\r\n * NameServiceMapping[T] is an alias for the type of the instance\r\n */\r\nvar Provider = /** @class */ (function () {\r\n    function Provider(name, container) {\r\n        this.name = name;\r\n        this.container = container;\r\n        this.component = null;\r\n        this.instances = new Map();\r\n        this.instancesDeferred = new Map();\r\n    }\r\n    /**\r\n     * @param identifier A provider can provide mulitple instances of a service\r\n     * if this.component.multipleInstances is true.\r\n     */\r\n    Provider.prototype.get = function (identifier) {\r\n        if (identifier === void 0) { identifier = DEFAULT_ENTRY_NAME; }\r\n        // if multipleInstances is not supported, use the default name\r\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\r\n            var deferred = new util.Deferred();\r\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\r\n            // If the service instance is available, resolve the promise with it immediately\r\n            try {\r\n                var instance = this.getOrInitializeService(normalizedIdentifier);\r\n                if (instance) {\r\n                    deferred.resolve(instance);\r\n                }\r\n            }\r\n            catch (e) {\r\n                // when the instance factory throws an exception during get(), it should not cause\r\n                // a fatal error. We just return the unresolved promise in this case.\r\n            }\r\n        }\r\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\r\n    };\r\n    Provider.prototype.getImmediate = function (options) {\r\n        var _a = tslib.__assign({ identifier: DEFAULT_ENTRY_NAME, optional: false }, options), identifier = _a.identifier, optional = _a.optional;\r\n        // if multipleInstances is not supported, use the default name\r\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        try {\r\n            var instance = this.getOrInitializeService(normalizedIdentifier);\r\n            if (!instance) {\r\n                if (optional) {\r\n                    return null;\r\n                }\r\n                throw Error(\"Service \" + this.name + \" is not available\");\r\n            }\r\n            return instance;\r\n        }\r\n        catch (e) {\r\n            if (optional) {\r\n                return null;\r\n            }\r\n            else {\r\n                throw e;\r\n            }\r\n        }\r\n    };\r\n    Provider.prototype.getComponent = function () {\r\n        return this.component;\r\n    };\r\n    Provider.prototype.setComponent = function (component) {\r\n        var e_1, _a;\r\n        if (component.name !== this.name) {\r\n            throw Error(\"Mismatching Component \" + component.name + \" for Provider \" + this.name + \".\");\r\n        }\r\n        if (this.component) {\r\n            throw Error(\"Component for \" + this.name + \" has already been provided\");\r\n        }\r\n        this.component = component;\r\n        // if the service is eager, initialize the default instance\r\n        if (isComponentEager(component)) {\r\n            try {\r\n                this.getOrInitializeService(DEFAULT_ENTRY_NAME);\r\n            }\r\n            catch (e) {\r\n                // when the instance factory for an eager Component throws an exception during the eager\r\n                // initialization, it should not cause a fatal error.\r\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\r\n                // a fatal error in this case?\r\n            }\r\n        }\r\n        try {\r\n            // Create service instances for the pending promises and resolve them\r\n            // NOTE: if this.multipleInstances is false, only the default instance will be created\r\n            // and all promises with resolve with it regardless of the identifier.\r\n            for (var _b = tslib.__values(this.instancesDeferred.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                var _d = tslib.__read(_c.value, 2), instanceIdentifier = _d[0], instanceDeferred = _d[1];\r\n                var normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n                try {\r\n                    // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\r\n                    var instance = this.getOrInitializeService(normalizedIdentifier);\r\n                    instanceDeferred.resolve(instance);\r\n                }\r\n                catch (e) {\r\n                    // when the instance factory throws an exception, it should not cause\r\n                    // a fatal error. We just leave the promise unresolved.\r\n                }\r\n            }\r\n        }\r\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n        finally {\r\n            try {\r\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n            }\r\n            finally { if (e_1) throw e_1.error; }\r\n        }\r\n    };\r\n    Provider.prototype.clearInstance = function (identifier) {\r\n        if (identifier === void 0) { identifier = DEFAULT_ENTRY_NAME; }\r\n        this.instancesDeferred.delete(identifier);\r\n        this.instances.delete(identifier);\r\n    };\r\n    // app.delete() will call this method on every provider to delete the services\r\n    // TODO: should we mark the provider as deleted?\r\n    Provider.prototype.delete = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var services;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        services = Array.from(this.instances.values());\r\n                        return [4 /*yield*/, Promise.all(tslib.__spread(services\r\n                                .filter(function (service) { return 'INTERNAL' in service; }) // legacy services\r\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                                .map(function (service) { return service.INTERNAL.delete(); }), services\r\n                                .filter(function (service) { return '_delete' in service; }) // modularized services\r\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                                .map(function (service) { return service._delete(); })))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Provider.prototype.isComponentSet = function () {\r\n        return this.component != null;\r\n    };\r\n    Provider.prototype.getOrInitializeService = function (identifier) {\r\n        var instance = this.instances.get(identifier);\r\n        if (!instance && this.component) {\r\n            instance = this.component.instanceFactory(this.container, normalizeIdentifierForFactory(identifier));\r\n            this.instances.set(identifier, instance);\r\n        }\r\n        return instance || null;\r\n    };\r\n    Provider.prototype.normalizeInstanceIdentifier = function (identifier) {\r\n        if (this.component) {\r\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\r\n        }\r\n        else {\r\n            return identifier; // assume multiple instances are supported before the component is provided.\r\n        }\r\n    };\r\n    return Provider;\r\n}());\r\n// undefined should be passed to the service factory for the default instance\r\nfunction normalizeIdentifierForFactory(identifier) {\r\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\r\n}\r\nfunction isComponentEager(component) {\r\n    return component.instantiationMode === \"EAGER\" /* EAGER */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nvar ComponentContainer = /** @class */ (function () {\r\n    function ComponentContainer(name) {\r\n        this.name = name;\r\n        this.providers = new Map();\r\n    }\r\n    /**\r\n     *\r\n     * @param component Component being added\r\n     * @param overwrite When a component with the same name has already been registered,\r\n     * if overwrite is true: overwrite the existing component with the new component and create a new\r\n     * provider with the new component. It can be useful in tests where you want to use different mocks\r\n     * for different tests.\r\n     * if overwrite is false: throw an exception\r\n     */\r\n    ComponentContainer.prototype.addComponent = function (component) {\r\n        var provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            throw new Error(\"Component \" + component.name + \" has already been registered with \" + this.name);\r\n        }\r\n        provider.setComponent(component);\r\n    };\r\n    ComponentContainer.prototype.addOrOverwriteComponent = function (component) {\r\n        var provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            // delete the existing provider from the container, so we can register the new component\r\n            this.providers.delete(component.name);\r\n        }\r\n        this.addComponent(component);\r\n    };\r\n    /**\r\n     * getProvider provides a type safe interface where it can only be called with a field name\r\n     * present in NameServiceMapping interface.\r\n     *\r\n     * Firebase SDKs providing services should extend NameServiceMapping interface to register\r\n     * themselves.\r\n     */\r\n    ComponentContainer.prototype.getProvider = function (name) {\r\n        if (this.providers.has(name)) {\r\n            return this.providers.get(name);\r\n        }\r\n        // create a Provider for a service that hasn't registered with Firebase\r\n        var provider = new Provider(name, this);\r\n        this.providers.set(name, provider);\r\n        return provider;\r\n    };\r\n    ComponentContainer.prototype.getProviders = function () {\r\n        return Array.from(this.providers.values());\r\n    };\r\n    return ComponentContainer;\r\n}());\n\nexports.Component = Component;\nexports.ComponentContainer = ComponentContainer;\nexports.Provider = Provider;\n//# sourceMappingURL=index.cjs.js.map\n","import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.17\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    var key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    var e_1, _a;\r\n    var callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    try {\r\n        for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\r\n            var callback = callbacks_1_1.value;\r\n            callback(fid);\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    var channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key: key, fid: fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nvar broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = function (e) {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, objectStore, oldValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, objectStore.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    return [4 /*yield*/, objectStore.put(value, key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 4:\r\n                    _a.sent();\r\n                    if (!oldValue || oldValue.fid !== value.fid) {\r\n                        fidChanged(appConfig, value.fid);\r\n                    }\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n                        fidChanged(appConfig, newValue.fid);\r\n                    }\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry;\r\n        var _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\r\nfunction onIdChange(_a, callback) {\r\n    var appConfig = _a.appConfig;\r\n    addCallback(appConfig, callback);\r\n    return function () {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        var installations = {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); },\r\n            onIdChange: function (callback) {\r\n                return onIdChange(dependencies, callback);\r\n            }\r\n        };\r\n        return installations;\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nvar instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\nvar levelStringToEnum = {\r\n    'debug': LogLevel.DEBUG,\r\n    'verbose': LogLevel.VERBOSE,\r\n    'info': LogLevel.INFO,\r\n    'warn': LogLevel.WARN,\r\n    'error': LogLevel.ERROR,\r\n    'silent': LogLevel.SILENT\r\n};\r\n/**\r\n * The default log level\r\n */\r\nvar defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * By default, `console.debug` is not displayed in the developer console (in\r\n * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n * logs to the `console.log` function.\r\n */\r\nvar ConsoleMethod = (_a = {},\r\n    _a[LogLevel.DEBUG] = 'log',\r\n    _a[LogLevel.VERBOSE] = 'log',\r\n    _a[LogLevel.INFO] = 'info',\r\n    _a[LogLevel.WARN] = 'warn',\r\n    _a[LogLevel.ERROR] = 'error',\r\n    _a);\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nvar defaultLogHandler = function (instance, logType) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    if (logType < instance.logLevel) {\r\n        return;\r\n    }\r\n    var now = new Date().toISOString();\r\n    var method = ConsoleMethod[logType];\r\n    if (method) {\r\n        console[method].apply(console, __spreadArrays([\"[\" + now + \"]  \" + instance.name + \":\"], args));\r\n    }\r\n    else {\r\n        throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");\r\n    }\r\n};\r\nvar Logger = /** @class */ (function () {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    function Logger(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The main (internal) log handler for the Logger instance.\r\n         * Can be set to a new function in internal package code but not by user.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * The optional, additional, user-defined log handler for the Logger instance.\r\n         */\r\n        this._userLogHandler = null;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    Object.defineProperty(Logger.prototype, \"logLevel\", {\r\n        get: function () {\r\n            return this._logLevel;\r\n        },\r\n        set: function (val) {\r\n            if (!(val in LogLevel)) {\r\n                throw new TypeError(\"Invalid value \\\"\" + val + \"\\\" assigned to `logLevel`\");\r\n            }\r\n            this._logLevel = val;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    // Workaround for setter/getter having to be the same type.\r\n    Logger.prototype.setLogLevel = function (val) {\r\n        this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\r\n    };\r\n    Object.defineProperty(Logger.prototype, \"logHandler\", {\r\n        get: function () {\r\n            return this._logHandler;\r\n        },\r\n        set: function (val) {\r\n            if (typeof val !== 'function') {\r\n                throw new TypeError('Value assigned to `logHandler` must be a function');\r\n            }\r\n            this._logHandler = val;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Logger.prototype, \"userLogHandler\", {\r\n        get: function () {\r\n            return this._userLogHandler;\r\n        },\r\n        set: function (val) {\r\n            this._userLogHandler = val;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    Logger.prototype.debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));\r\n    };\r\n    Logger.prototype.log = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));\r\n    };\r\n    Logger.prototype.info = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));\r\n    };\r\n    Logger.prototype.warn = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));\r\n    };\r\n    Logger.prototype.error = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));\r\n    };\r\n    return Logger;\r\n}());\r\nfunction setLogLevel(level) {\r\n    instances.forEach(function (inst) {\r\n        inst.setLogLevel(level);\r\n    });\r\n}\r\nfunction setUserLogHandler(logCallback, options) {\r\n    var _loop_1 = function (instance) {\r\n        var customLogLevel = null;\r\n        if (options && options.level) {\r\n            customLogLevel = levelStringToEnum[options.level];\r\n        }\r\n        if (logCallback === null) {\r\n            instance.userLogHandler = null;\r\n        }\r\n        else {\r\n            instance.userLogHandler = function (instance, level) {\r\n                var args = [];\r\n                for (var _i = 2; _i < arguments.length; _i++) {\r\n                    args[_i - 2] = arguments[_i];\r\n                }\r\n                var message = args\r\n                    .map(function (arg) {\r\n                    if (arg == null) {\r\n                        return null;\r\n                    }\r\n                    else if (typeof arg === 'string') {\r\n                        return arg;\r\n                    }\r\n                    else if (typeof arg === 'number' || typeof arg === 'boolean') {\r\n                        return arg.toString();\r\n                    }\r\n                    else if (arg instanceof Error) {\r\n                        return arg.message;\r\n                    }\r\n                    else {\r\n                        try {\r\n                            return JSON.stringify(arg);\r\n                        }\r\n                        catch (ignored) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                })\r\n                    .filter(function (arg) { return arg; })\r\n                    .join(' ');\r\n                if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {\r\n                    logCallback({\r\n                        level: LogLevel[level].toLowerCase(),\r\n                        message: message,\r\n                        args: args,\r\n                        type: instance.name\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    };\r\n    for (var _i = 0, instances_1 = instances; _i < instances_1.length; _i++) {\r\n        var instance = instances_1[_i];\r\n        _loop_1(instance);\r\n    }\r\n}\n\nexport { LogLevel, Logger, setLogLevel, setUserLogHandler };\n//# sourceMappingURL=index.esm.js.map\n"],"sourceRoot":""}